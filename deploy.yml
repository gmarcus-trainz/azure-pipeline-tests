parameters:
    webSiteName: "Dev.Trainz.Tricia"
    projectName: 'Dev.Trainz.Tricia'
    appPoolName: 'Dev.Trainz.Trizia'
    

variables:
- name: websitePhysicalPath
  value: '%SystemDrive%\inetpub\wwwroot\${{parameters.websiteName}}'
- name: buildConfiguration
  value: 'Release'

steps:
- download: current
  artifact: drop

- task: IISWebAppManagementOnMachineGroup@0
            inputs:            
              IISDeploymentType: 'IISWebsite'
              ActionIISWebsite: 'CreateOrUpdateWebsite'
              WebsiteName: '${{parameters.websiteName}}'
              WebsitePhysicalPath: '$(websitePhysicalPath)'
              WebsitePhysicalPathAuth: 'WebsiteUserPassThrough'
              CreateOrUpdateAppPoolForWebsite: true
              AppPoolNameForWebsite: '${{ parameters.appPoolName}}'
              DotNetVersionForWebsite: 'No Managed Code'
              PipeLineModeForWebsite: 'Integrated'
              AppPoolIdentityForWebsite: 'ApplicationPoolIdentity'
              AddBinding: true
              Bindings: |
                  {
                      bindings:[
                          {
                              "protocol":"http",
                              "ipAddress":"",
                              "hostname":"",
                              "port":"80",
                              "sslThumbprint":"",
                              "sniFlag":false
                          }
                      ]
                  }
          - task: IISWebAppDeploymentOnMachineGroup@0
            inputs:
              WebSiteName: '${{parameters.websiteName}}'
              Package: '$(Pipeline.Workspace)/drop/$(buildConfiguration)/${{parameters.projectName}}.zip'
